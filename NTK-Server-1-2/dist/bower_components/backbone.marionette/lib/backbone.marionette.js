// MarionetteJS (Backbone.Marionette)
// ----------------------------------
// v2.0.3
//
// Copyright (c)2014 Derick Bailey, Muted Solutions, LLC.
// Distributed under MIT license
//
// http://marionettejs.com

/*!
 * Includes BabySitter
 * https://github.com/marionettejs/backbone.babysitter/
 *
 * Includes Wreqr
 * https://github.com/marionettejs/backbone.wreqr/
 */

// Copyright (c)2014 Derick Bailey, Muted Solutions, LLC.

// Distributed under MIT license

!function(t,e){if("function"==typeof define&&define.amd)define(["backbone","underscore"],function(i,n){return t.Marionette=e(t,i,n)});else if("undefined"!=typeof exports){var i=require("backbone"),n=require("underscore");module.exports=e(t,i,n)}else t.Marionette=e(t,t.Backbone,t._)}(this,function(t,e,i){function n(t,e){var i=new Error(t);throw i.name=e||"Error",i}!function(t,e){var i=t.ChildViewContainer;return t.ChildViewContainer=function(t,e){var i=function(t){this._views={},this._indexByModel={},this._indexByCustom={},this._updateLength(),e.each(t,this.add,this)};e.extend(i.prototype,{add:function(t,e){var i=t.cid;return this._views[i]=t,t.model&&(this._indexByModel[t.model.cid]=i),e&&(this._indexByCustom[e]=i),this._updateLength(),this},findByModel:function(t){return this.findByModelCid(t.cid)},findByModelCid:function(t){var e=this._indexByModel[t];return this.findByCid(e)},findByCustom:function(t){var e=this._indexByCustom[t];return this.findByCid(e)},findByIndex:function(t){return e.values(this._views)[t]},findByCid:function(t){return this._views[t]},remove:function(t){var i=t.cid;return t.model&&delete this._indexByModel[t.model.cid],e.any(this._indexByCustom,function(t,e){return t===i?(delete this._indexByCustom[e],!0):void 0},this),delete this._views[i],this._updateLength(),this},call:function(t){this.apply(t,e.tail(arguments))},apply:function(t,i){e.each(this._views,function(n){e.isFunction(n[t])&&n[t].apply(n,i||[])})},_updateLength:function(){this.length=e.size(this._views)}});var n=["forEach","each","map","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","toArray","first","initial","rest","last","without","isEmpty","pluck"];return e.each(n,function(t){i.prototype[t]=function(){var i=e.values(this._views),n=[i].concat(e.toArray(arguments));return e[t].apply(e,n)}}),i}(t,e),t.ChildViewContainer.VERSION="0.1.4",t.ChildViewContainer.noConflict=function(){return t.ChildViewContainer=i,this},t.ChildViewContainer}(e,i),function(t,e){var i=t.Wreqr,n=t.Wreqr={};return t.Wreqr.VERSION="1.3.1",t.Wreqr.noConflict=function(){return t.Wreqr=i,this},n.Handlers=function(t,e){var i=function(t){this.options=t,this._wreqrHandlers={},e.isFunction(this.initialize)&&this.initialize(t)};return i.extend=t.Model.extend,e.extend(i.prototype,t.Events,{setHandlers:function(t){e.each(t,function(t,i){var n=null;e.isObject(t)&&!e.isFunction(t)&&(n=t.context,t=t.callback),this.setHandler(i,t,n)},this)},setHandler:function(t,e,i){var n={callback:e,context:i};this._wreqrHandlers[t]=n,this.trigger("handler:add",t,e,i)},hasHandler:function(t){return!!this._wreqrHandlers[t]},getHandler:function(t){var e=this._wreqrHandlers[t];if(e)return function(){var t=Array.prototype.slice.apply(arguments);return e.callback.apply(e.context,t)}},removeHandler:function(t){delete this._wreqrHandlers[t]},removeAllHandlers:function(){this._wreqrHandlers={}}}),i}(t,e),n.CommandStorage=function(){var i=function(t){this.options=t,this._commands={},e.isFunction(this.initialize)&&this.initialize(t)};return e.extend(i.prototype,t.Events,{getCommands:function(t){var e=this._commands[t];return e||(e={command:t,instances:[]},this._commands[t]=e),e},addCommand:function(t,e){var i=this.getCommands(t);i.instances.push(e)},clearCommands:function(t){var e=this.getCommands(t);e.instances=[]}}),i}(),n.Commands=function(t){return t.Handlers.extend({storageType:t.CommandStorage,constructor:function(e){this.options=e||{},this._initializeStorage(this.options),this.on("handler:add",this._executeCommands,this);var i=Array.prototype.slice.call(arguments);t.Handlers.prototype.constructor.apply(this,i)},execute:function(t,e){t=arguments[0],e=Array.prototype.slice.call(arguments,1),this.hasHandler(t)?this.getHandler(t).apply(this,e):this.storage.addCommand(t,e)},_executeCommands:function(t,i,n){var r=this.storage.getCommands(t);e.each(r.instances,function(t){i.apply(n,t)}),this.storage.clearCommands(t)},_initializeStorage:function(t){var i,n=t.storageType||this.storageType;i=e.isFunction(n)?new n:n,this.storage=i}})}(n),n.RequestResponse=function(t){return t.Handlers.extend({request:function(){var t=arguments[0],e=Array.prototype.slice.call(arguments,1);return this.hasHandler(t)?this.getHandler(t).apply(this,e):void 0}})}(n),n.EventAggregator=function(t,e){var i=function(){};return i.extend=t.Model.extend,e.extend(i.prototype,t.Events),i}(t,e),n.Channel=function(){var i=function(e){this.vent=new t.Wreqr.EventAggregator,this.reqres=new t.Wreqr.RequestResponse,this.commands=new t.Wreqr.Commands,this.channelName=e};return e.extend(i.prototype,{reset:function(){return this.vent.off(),this.vent.stopListening(),this.reqres.removeAllHandlers(),this.commands.removeAllHandlers(),this},connectEvents:function(t,e){return this._connect("vent",t,e),this},connectCommands:function(t,e){return this._connect("commands",t,e),this},connectRequests:function(t,e){return this._connect("reqres",t,e),this},_connect:function(t,i,n){if(i){n=n||this;var r="vent"===t?"on":"setHandler";e.each(i,function(i,s){this[t][r](s,e.bind(i,n))},this)}}}),i}(n),n.radio=function(t){var i=function(){this._channels={},this.vent={},this.commands={},this.reqres={},this._proxyMethods()};e.extend(i.prototype,{channel:function(t){if(!t)throw new Error("Channel must receive a name");return this._getChannel(t)},_getChannel:function(e){var i=this._channels[e];return i||(i=new t.Channel(e),this._channels[e]=i),i},_proxyMethods:function(){e.each(["vent","commands","reqres"],function(t){e.each(n[t],function(e){this[t][e]=r(this,t,e)},this)},this)}});var n={vent:["on","off","trigger","once","stopListening","listenTo","listenToOnce"],commands:["execute","setHandler","setHandlers","removeHandler","removeAllHandlers"],reqres:["request","setHandler","setHandlers","removeHandler","removeAllHandlers"]},r=function(t,e,i){return function(n){var r=t._getChannel(n)[e],s=Array.prototype.slice.call(arguments,1);return r[i].apply(r,s)}};return new i}(n),t.Wreqr}(e,i);var r=t.Marionette,s=e.Marionette={};s.VERSION="2.0.3",s.noConflict=function(){return t.Marionette=r,this},e.Marionette=s,s.Deferred=e.$.Deferred;var o=Array.prototype.slice;return s.extend=e.Model.extend,s.getOption=function(t,e){if(t&&e){var i;return i=t.options&&void 0!==t.options[e]?t.options[e]:t[e]}},s.proxyGetOption=function(t){return s.getOption(this,t)},s.normalizeMethods=function(t){var e,n={};return i.each(t,function(t,r){e=t,i.isFunction(e)||(e=this[e]),e&&(n[r]=e)},this),n},s.normalizeUIKeys=function(t,e){return"undefined"!=typeof t?(i.each(i.keys(t),function(i){var n=/@ui.[a-zA-Z_$0-9]*/g;i.match(n)&&(t[i.replace(n,function(t){return e[t.slice(4)]})]=t[i],delete t[i])}),t):void 0},s.actAsCollection=function(t,e){var n=["forEach","each","map","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","toArray","first","initial","rest","last","without","isEmpty","pluck"];i.each(n,function(n){t[n]=function(){var t=i.values(i.result(this,e)),r=[t].concat(i.toArray(arguments));return i[n].apply(i,r)}})},s.triggerMethod=function(){function t(t,e,i){return i.toUpperCase()}var e=/(^|:)(\w)/gi,n=function(n){var r,s="on"+n.replace(e,t),o=this[s];return i.isFunction(o)&&(r=o.apply(this,i.tail(arguments))),i.isFunction(this.trigger)&&this.trigger.apply(this,arguments),r};return n}(),s.MonitorDOMRefresh=function(t){function e(t){t._isShown=!0,r(t)}function n(t){t._isRendered=!0,r(t)}function r(t){t._isShown&&t._isRendered&&s(t)&&i.isFunction(t.triggerMethod)&&t.triggerMethod("dom:refresh")}function s(e){return t.contains(e.el)}return function(t){t.listenTo(t,"show",function(){e(t)}),t.listenTo(t,"render",function(){n(t)})}}(document.documentElement),function(t){function e(t,e,r,s){var o=s.split(/\s+/);i.each(o,function(i){var s=t[i];s||n('Method "'+i+'" was configured as an event handler, but does not exist.'),t.listenTo(e,r,s)})}function r(t,e,i,n){t.listenTo(e,i,n)}function s(t,e,n,r){var s=r.split(/\s+/);i.each(s,function(i){var r=t[i];t.stopListening(e,n,r)})}function o(t,e,i,n){t.stopListening(e,i,n)}function h(t,e,n,r,s){e&&n&&(i.isFunction(n)&&(n=n.call(t)),i.each(n,function(n,o){i.isFunction(n)?r(t,e,o,n):s(t,e,o,n)}))}t.bindEntityEvents=function(t,i,n){h(t,i,n,r,e)},t.unbindEntityEvents=function(t,e,i){h(t,e,i,o,s)},t.proxyBindEntityEvents=function(e,i){return t.bindEntityEvents(this,e,i)},t.proxyUnbindEntityEvents=function(e,i){return t.unbindEntityEvents(this,e,i)}}(s),s.Callbacks=function(){this._deferred=s.Deferred(),this._callbacks=[]},i.extend(s.Callbacks.prototype,{add:function(t,e){var n=i.result(this._deferred,"promise");this._callbacks.push({cb:t,ctx:e}),n.then(function(i){e&&(i.context=e),t.call(i.context,i.options)})},run:function(t,e){this._deferred.resolve({options:t,context:e})},reset:function(){var t=this._callbacks;this._deferred=s.Deferred(),this._callbacks=[],i.each(t,function(t){this.add(t.cb,t.ctx)},this)}}),s.Controller=function(t){this.options=t||{},i.isFunction(this.initialize)&&this.initialize(this.options)},s.Controller.extend=s.extend,i.extend(s.Controller.prototype,e.Events,{destroy:function(){var t=Array.prototype.slice.call(arguments);this.triggerMethod.apply(this,["before:destroy"].concat(t)),this.triggerMethod.apply(this,["destroy"].concat(t)),this.stopListening(),this.off()},triggerMethod:s.triggerMethod,getOption:s.proxyGetOption}),s.Region=function(t){if(this.options=t||{},this.el=this.getOption("el"),this.el=this.el instanceof e.$?this.el[0]:this.el,this.el||n('An "el" must be specified for a region.',"NoElError"),this.$el=this.getEl(this.el),this.initialize){var i=Array.prototype.slice.apply(arguments);this.initialize.apply(this,i)}},i.extend(s.Region,{buildRegion:function(t,r){var s=i.isString(t),o=i.isString(t.selector),h=i.isUndefined(t.regionClass),a=i.isFunction(t);a||s||o||n("Region must be specified as a Region class,a selector string or an object with selector property");var l,c;s&&(l=t),t.selector&&(l=t.selector,delete t.selector),a&&(c=t),!a&&h&&(c=r),t.regionClass&&(c=t.regionClass,delete t.regionClass),(s||a)&&(t={}),t.el=l;var d=new c(t);return t.parentEl&&(d.getEl=function(n){if(i.isObject(n))return e.$(n);var r=t.parentEl;return i.isFunction(r)&&(r=r()),r.find(n)}),d}}),i.extend(s.Region.prototype,e.Events,{show:function(t,e){this._ensureElement();var n=e||{},r=t!==this.currentView,s=!!n.preventDestroy,o=!!n.forceShow,h=!!this.currentView,a=!s&&r;a&&this.empty();var l=r||o;return l?(t.once("destroy",i.bind(this.empty,this)),t.render(),h&&this.triggerMethod("before:swap",t),this.triggerMethod("before:show",t),i.isFunction(t.triggerMethod)?t.triggerMethod("before:show"):this.triggerMethod.call(t,"before:show"),this.attachHtml(t),this.currentView=t,h&&this.triggerMethod("swap",t),this.triggerMethod("show",t),i.isFunction(t.triggerMethod)?t.triggerMethod("show"):this.triggerMethod.call(t,"show"),this):this},_ensureElement:function(){i.isObject(this.el)||(this.$el=this.getEl(this.el),this.el=this.$el[0]),this.$el&&0!==this.$el.length||n('An "el" '+this.$el.selector+" must exist in DOM")},getEl:function(t){return e.$(t)},attachHtml:function(t){this.el.innerHTML="",this.el.appendChild(t.el)},empty:function(){var t=this.currentView;t&&(this.triggerMethod("before:empty",t),this._destroyView(),this.triggerMethod("empty",t),delete this.currentView)},_destroyView:function(){var t=this.currentView;t.destroy&&!t.isDestroyed?t.destroy():t.remove&&t.remove()},attachView:function(t){this.currentView=t},reset:function(){this.empty(),this.$el&&(this.el=this.$el.selector),delete this.$el},getOption:s.proxyGetOption,triggerMethod:s.triggerMethod}),s.Region.extend=s.extend,s.RegionManager=function(t){var e=t.Controller.extend({constructor:function(e){this._regions={},t.Controller.call(this,e)},addRegions:function(t,e){var n={};return i.each(t,function(t,r){i.isString(t)&&(t={selector:t}),t.selector&&(t=i.defaults({},t,e));var s=this.addRegion(r,t);n[r]=s},this),n},addRegion:function(e,n){var r,s=i.isObject(n),o=i.isString(n),h=!!n.selector;return r=o||s&&h?t.Region.buildRegion(n,t.Region):i.isFunction(n)?t.Region.buildRegion(n,t.Region):n,this.triggerMethod("before:add:region",e,r),this._store(e,r),this.triggerMethod("add:region",e,r),r},get:function(t){return this._regions[t]},getRegions:function(){return i.clone(this._regions)},removeRegion:function(t){var e=this._regions[t];this._remove(t,e)},removeRegions:function(){i.each(this._regions,function(t,e){this._remove(e,t)},this)},emptyRegions:function(){i.each(this._regions,function(t){t.empty()},this)},destroy:function(){this.removeRegions(),t.Controller.prototype.destroy.apply(this,arguments)},_store:function(t,e){this._regions[t]=e,this._setLength()},_remove:function(t,e){this.triggerMethod("before:remove:region",t,e),e.empty(),e.stopListening(),delete this._regions[t],this._setLength(),this.triggerMethod("remove:region",t,e)},_setLength:function(){this.length=i.size(this._regions)}});return t.actAsCollection(e.prototype,"_regions"),e}(s),s.TemplateCache=function(t){this.templateId=t},i.extend(s.TemplateCache,{templateCaches:{},get:function(t){var e=this.templateCaches[t];return e||(e=new s.TemplateCache(t),this.templateCaches[t]=e),e.load()},clear:function(){var t,e=o.call(arguments),i=e.length;if(i>0)for(t=0;i>t;t++)delete this.templateCaches[e[t]];else this.templateCaches={}}}),i.extend(s.TemplateCache.prototype,{load:function(){if(this.compiledTemplate)return this.compiledTemplate;var t=this.loadTemplate(this.templateId);return this.compiledTemplate=this.compileTemplate(t),this.compiledTemplate},loadTemplate:function(t){var i=e.$(t).html();return i&&0!==i.length||n('Could not find template: "'+t+'"',"NoTemplateError"),i},compileTemplate:function(t){return i.template(t)}}),s.Renderer={render:function(t,e){t||n("Cannot render the template since its false, null or undefined.","TemplateNotFoundError");var i;return(i="function"==typeof t?t:s.TemplateCache.get(t))(e)}},s.View=e.View.extend({constructor:function(t){i.bindAll(this,"render"),this.options=i.extend({},i.result(this,"options"),i.isFunction(t)?t.call(this):t),this.events=this.normalizeUIKeys(i.result(this,"events")),i.isObject(this.behaviors)&&new s.Behaviors(this),e.View.apply(this,arguments),s.MonitorDOMRefresh(this),this.listenTo(this,"show",this.onShowCalled)},getTemplate:function(){return this.getOption("template")},mixinTemplateHelpers:function(t){t=t||{};var e=this.getOption("templateHelpers");return i.isFunction(e)&&(e=e.call(this)),i.extend(t,e)},normalizeUIKeys:function(t){var e=i.result(this,"ui"),n=i.result(this,"_uiBindings");return s.normalizeUIKeys(t,n||e)},configureTriggers:function(){if(this.triggers){var t={},e=this.normalizeUIKeys(i.result(this,"triggers"));return i.each(e,function(e,n){var r=i.isObject(e),s=r?e.event:e;t[n]=function(t){if(t){var i=t.preventDefault,n=t.stopPropagation,o=r?e.preventDefault:i,h=r?e.stopPropagation:n;o&&i&&i.apply(t),h&&n&&n.apply(t)}var a={view:this,model:this.model,collection:this.collection};this.triggerMethod(s,a)}},this),t}},delegateEvents:function(t){this._delegateDOMEvents(t),this.bindEntityEvents(this.model,this.getOption("modelEvents")),this.bindEntityEvents(this.collection,this.getOption("collectionEvents"))},_delegateDOMEvents:function(t){t=t||this.events,i.isFunction(t)&&(t=t.call(this)),t=this.normalizeUIKeys(t);var n={},r=i.result(this,"behaviorEvents")||{},s=this.configureTriggers();i.extend(n,r,t,s),e.View.prototype.delegateEvents.call(this,n)},undelegateEvents:function(){var t=Array.prototype.slice.call(arguments);e.View.prototype.undelegateEvents.apply(this,t),this.unbindEntityEvents(this.model,this.getOption("modelEvents")),this.unbindEntityEvents(this.collection,this.getOption("collectionEvents"))},onShowCalled:function(){},_ensureViewIsIntact:function(){if(this.isDestroyed){var t=new Error("Cannot use a view thats already been destroyed.");throw t.name="ViewDestroyedError",t}},destroy:function(){if(!this.isDestroyed){var t=Array.prototype.slice.call(arguments);this.triggerMethod.apply(this,["before:destroy"].concat(t)),this.isDestroyed=!0,this.triggerMethod.apply(this,["destroy"].concat(t)),this.unbindUIElements(),this.remove()}},bindUIElements:function(){if(this.ui){this._uiBindings||(this._uiBindings=this.ui);var t=i.result(this,"_uiBindings");this.ui={},i.each(i.keys(t),function(e){var i=t[e];this.ui[e]=this.$(i)},this)}},unbindUIElements:function(){this.ui&&this._uiBindings&&(i.each(this.ui,function(t,e){delete this.ui[e]},this),this.ui=this._uiBindings,delete this._uiBindings)},triggerMethod:s.triggerMethod,normalizeMethods:s.normalizeMethods,getOption:s.proxyGetOption,bindEntityEvents:s.proxyBindEntityEvents,unbindEntityEvents:s.proxyUnbindEntityEvents}),s.ItemView=s.View.extend({constructor:function(){s.View.apply(this,arguments)},serializeData:function(){var t={};return this.model?t=this.model.toJSON():this.collection&&(t={items:this.collection.toJSON()}),t},render:function(){this._ensureViewIsIntact(),this.triggerMethod("before:render",this);var t=this.serializeData();t=this.mixinTemplateHelpers(t);var e=this.getTemplate(),i=s.Renderer.render(e,t);return this.attachElContent(i),this.bindUIElements(),this.triggerMethod("render",this),this},attachElContent:function(t){return this.$el.html(t),this},destroy:function(){this.isDestroyed||s.View.prototype.destroy.apply(this,arguments)}}),s.CollectionView=s.View.extend({childViewEventPrefix:"childview",constructor:function(t){var e=t||{};this.sort=i.isUndefined(e.sort)?!0:e.sort,this._initChildViewStorage(),s.View.apply(this,arguments),this._initialEvents(),this.initRenderBuffer()},initRenderBuffer:function(){this.elBuffer=document.createDocumentFragment(),this._bufferedChildren=[]},startBuffering:function(){this.initRenderBuffer(),this.isBuffering=!0},endBuffering:function(){this.isBuffering=!1,this._triggerBeforeShowBufferedChildren(),this.attachBuffer(this,this.elBuffer),this._triggerShowBufferedChildren(),this.initRenderBuffer()},_triggerBeforeShowBufferedChildren:function(){this._isShown&&i.invoke(this._bufferedChildren,"triggerMethod","before:show")},_triggerShowBufferedChildren:function(){this._isShown&&(i.each(this._bufferedChildren,function(t){i.isFunction(t.triggerMethod)?t.triggerMethod("show"):s.triggerMethod.call(t,"show")}),this._bufferedChildren=[])},_initialEvents:function(){this.collection&&(this.listenTo(this.collection,"add",this._onCollectionAdd),this.listenTo(this.collection,"remove",this._onCollectionRemove),this.listenTo(this.collection,"reset",this.render),this.sort&&this.listenTo(this.collection,"sort",this._sortViews))},_onCollectionAdd:function(t){this.destroyEmptyView();var e=this.getChildView(t),i=this.collection.indexOf(t);this.addChild(t,e,i)},_onCollectionRemove:function(t){var e=this.children.findByModel(t);this.removeChildView(e),this.checkEmpty()},onShowCalled:function(){this.children.each(function(t){i.isFunction(t.triggerMethod)?t.triggerMethod("show"):s.triggerMethod.call(t,"show")})},render:function(){return this._ensureViewIsIntact(),this.triggerMethod("before:render",this),this._renderChildren(),this.triggerMethod("render",this),this},_sortViews:function(){var t=this.collection.find(function(t,e){var i=this.children.findByModel(t);return i&&i._index!==e},this);t&&this.render()},_renderChildren:function(){this.destroyEmptyView(),this.destroyChildren(),this.isEmpty(this.collection)?this.showEmptyView():(this.triggerMethod("before:render:collection",this),this.startBuffering(),this.showCollection(),this.endBuffering(),this.triggerMethod("render:collection",this))},showCollection:function(){var t;this.collection.each(function(e,i){t=this.getChildView(e),this.addChild(e,t,i)},this)},showEmptyView:function(){var t=this.getEmptyView();if(t&&!this._showingEmptyView){this.triggerMethod("before:render:empty"),this._showingEmptyView=!0;var i=new e.Model;this.addEmptyView(i,t),this.triggerMethod("render:empty")}},destroyEmptyView:function(){this._showingEmptyView&&(this.destroyChildren(),delete this._showingEmptyView)},getEmptyView:function(){return this.getOption("emptyView")},addEmptyView:function(t,e){var n=this.getOption("emptyViewOptions")||this.getOption("childViewOptions");i.isFunction(n)&&(n=n.call(this));var r=this.buildChildView(t,e,n);this._isShown&&this.triggerMethod.call(r,"before:show"),this.children.add(r),this.renderChildView(r,-1),this._isShown&&this.triggerMethod.call(r,"show")},getChildView:function(){var t=this.getOption("childView");return t||n('A "childView" must be specified',"NoChildViewError"),t},addChild:function(t,e,n){var r=this.getOption("childViewOptions");i.isFunction(r)&&(r=r.call(this,t,n));var s=this.buildChildView(t,e,r);return this._updateIndices(s,!0,n),this._addChildView(s,n),s},_updateIndices:function(t,e,i){this.sort&&(e?(t._index=i,this.children.each(function(e){e._index>=t._index&&e._index++})):this.children.each(function(e){e._index>=t._index&&e._index--}))},_addChildView:function(t,e){this.proxyChildEvents(t),this.triggerMethod("before:add:child",t),this.children.add(t),this.renderChildView(t,e),this._isShown&&!this.isBuffering&&(i.isFunction(t.triggerMethod)?t.triggerMethod("show"):s.triggerMethod.call(t,"show")),this.triggerMethod("add:child",t)},renderChildView:function(t,e){t.render(),this.attachHtml(this,t,e)},buildChildView:function(t,e,n){var r=i.extend({model:t},n);return new e(r)},removeChildView:function(t){t&&(this.triggerMethod("before:remove:child",t),t.destroy?t.destroy():t.remove&&t.remove(),this.stopListening(t),this.children.remove(t),this.triggerMethod("remove:child",t),this._updateIndices(t,!1))},isEmpty:function(){return!this.collection||0===this.collection.length},checkEmpty:function(){this.isEmpty(this.collection)&&this.showEmptyView()},attachBuffer:function(t,e){t.$el.append(e)},attachHtml:function(t,e,i){t.isBuffering?(t.elBuffer.appendChild(e.el),t._bufferedChildren.push(e)):t._insertBefore(e,i)||t._insertAfter(e)},_insertBefore:function(t,e){var i,n=this.sort&&e<this.children.length-1;return n&&(i=this.children.find(function(t){return t._index===e+1})),i?(i.$el.before(t.el),!0):!1},_insertAfter:function(t){this.$el.append(t.el)},_initChildViewStorage:function(){this.children=new e.ChildViewContainer},destroy:function(){this.isDestroyed||(this.triggerMethod("before:destroy:collection"),this.destroyChildren(),this.triggerMethod("destroy:collection"),s.View.prototype.destroy.apply(this,arguments))},destroyChildren:function(){this.children.each(this.removeChildView,this),this.checkEmpty()},proxyChildEvents:function(t){var e=this.getOption("childViewEventPrefix");this.listenTo(t,"all",function(){var n=Array.prototype.slice.call(arguments),r=n[0],s=this.normalizeMethods(i.result(this,"childEvents"));n[0]=e+":"+r,n.splice(1,0,t),"undefined"!=typeof s&&i.isFunction(s[r])&&s[r].apply(this,n.slice(1)),this.triggerMethod.apply(this,n)},this)}}),s.CompositeView=s.CollectionView.extend({constructor:function(){s.CollectionView.apply(this,arguments)},_initialEvents:function(){this.once("render",function(){this.collection&&(this.listenTo(this.collection,"add",this._onCollectionAdd),this.listenTo(this.collection,"remove",this._onCollectionRemove),this.listenTo(this.collection,"reset",this._renderChildren),this.sort&&this.listenTo(this.collection,"sort",this._sortViews))})},getChildView:function(){var t=this.getOption("childView")||this.constructor;return t||n('A "childView" must be specified',"NoChildViewError"),t},serializeData:function(){var t={};return this.model&&(t=this.model.toJSON()),t},render:function(){return this._ensureViewIsIntact(),this.isRendered=!0,this.resetChildViewContainer(),this.triggerMethod("before:render",this),this._renderRoot(),this._renderChildren(),this.triggerMethod("render",this),this},_renderChildren:function(){this.isRendered&&s.CollectionView.prototype._renderChildren.call(this)},_renderRoot:function(){var t={};t=this.serializeData(),t=this.mixinTemplateHelpers(t),this.triggerMethod("before:render:template");var e=this.getTemplate(),i=s.Renderer.render(e,t);this.attachElContent(i),this.bindUIElements(),this.triggerMethod("render:template")},attachElContent:function(t){return this.$el.html(t),this},attachBuffer:function(t,e){var i=this.getChildViewContainer(t);i.append(e)},_insertAfter:function(t){var e=this.getChildViewContainer(this);e.append(t.el)},getChildViewContainer:function(t){if("$childViewContainer"in t)return t.$childViewContainer;var e,r=s.getOption(t,"childViewContainer");if(r){var o=i.isFunction(r)?r.call(t):r;e="@"===o.charAt(0)&&t.ui?t.ui[o.substr(4)]:t.$(o),e.length<=0&&n('The specified "childViewContainer" was not found: '+t.childViewContainer,"ChildViewContainerMissingError")}else e=t.$el;return t.$childViewContainer=e,e},resetChildViewContainer:function(){this.$childViewContainer&&delete this.$childViewContainer}}),s.LayoutView=s.ItemView.extend({regionClass:s.Region,constructor:function(t){t=t||{},this._firstRender=!0,this._initializeRegions(t),s.ItemView.call(this,t)},render:function(){return this._ensureViewIsIntact(),this._firstRender?this._firstRender=!1:this._reInitializeRegions(),s.ItemView.prototype.render.apply(this,arguments)},destroy:function(){this.isDestroyed||(this.regionManager.destroy(),s.ItemView.prototype.destroy.apply(this,arguments))},addRegion:function(t,e){this.triggerMethod("before:region:add",t);var i={};return i[t]=e,this._buildRegions(i)[t]},addRegions:function(t){return this.regions=i.extend({},this.regions,t),this._buildRegions(t)},removeRegion:function(t){return this.triggerMethod("before:region:remove",t),delete this.regions[t],this.regionManager.removeRegion(t)},getRegion:function(t){return this.regionManager.get(t)},getRegions:function(){return this.regionManager.getRegions()},_buildRegions:function(t){var e=this,i={regionClass:this.getOption("regionClass"),parentEl:function(){return e.$el}};return this.regionManager.addRegions(t,i)},_initializeRegions:function(t){var e;this._initRegionManager(),e=i.isFunction(this.regions)?this.regions(t):this.regions||{};var n=this.getOption.call(t,"regions");i.isFunction(n)&&(n=n.call(this,t)),i.extend(e,n),this.addRegions(e)},_reInitializeRegions:function(){this.regionManager.emptyRegions(),this.regionManager.each(function(t){t.reset()})},getRegionManager:function(){return new s.RegionManager},_initRegionManager:function(){this.regionManager=this.getRegionManager(),this.listenTo(this.regionManager,"before:add:region",function(t){this.triggerMethod("before:add:region",t)}),this.listenTo(this.regionManager,"add:region",function(t,e){this[t]=e,this.triggerMethod("add:region",t,e)}),this.listenTo(this.regionManager,"before:remove:region",function(t){this.triggerMethod("before:remove:region",t)}),this.listenTo(this.regionManager,"remove:region",function(t,e){delete this[t],this.triggerMethod("remove:region",t,e)})}}),s.Behavior=function(t,e){function i(e,i){this.view=i,this.defaults=t.result(this,"defaults")||{},this.options=t.extend({},this.defaults,e),this.$=function(){return this.view.$.apply(this.view,arguments)},this.initialize.apply(this,arguments)}return t.extend(i.prototype,e.Events,{initialize:function(){},destroy:function(){this.stopListening()},triggerMethod:s.triggerMethod,getOption:s.proxyGetOption,bindEntityEvents:s.proxyBindEntityEvents,unbindEntityEvents:s.proxyUnbindEntityEvents}),i.extend=s.extend,i}(i,e),s.Behaviors=function(t,e){function i(t,r){r=i.parseBehaviors(t,r||e.result(t,"behaviors")),i.wrap(t,r,e.keys(n))}var n={setElement:function(t,i){t.apply(this,e.tail(arguments,2)),e.each(i,function(t){t.$el=this.$el},this)},destroy:function(t,i){var n=e.tail(arguments,2);t.apply(this,n),e.invoke(i,"destroy",n)},bindUIElements:function(t,i){t.apply(this),e.invoke(i,t)},unbindUIElements:function(t,i){t.apply(this),e.invoke(i,t)},triggerMethod:function(t,i){var n=e.tail(arguments,2);t.apply(this,n),e.each(i,function(e){t.apply(e,n)})},delegateEvents:function(i,n){var r=e.tail(arguments,2);i.apply(this,r),e.each(n,function(e){t.bindEntityEvents(e,this.model,t.getOption(e,"modelEvents")),t.bindEntityEvents(e,this.collection,t.getOption(e,"collectionEvents"))},this)},undelegateEvents:function(i,n){var r=e.tail(arguments,2);i.apply(this,r),e.each(n,function(e){t.unbindEntityEvents(e,this.model,t.getOption(e,"modelEvents")),t.unbindEntityEvents(e,this.collection,t.getOption(e,"collectionEvents"))},this)},behaviorEvents:function(i,n){var r={},s=e.result(this,"ui");return e.each(n,function(i,n){var o={},h=e.clone(e.result(i,"events"))||{},a=e.result(i,"ui"),l=e.extend({},s,a);h=t.normalizeUIKeys(h,l),e.each(e.keys(h),function(t){var r=new Array(n+2).join(" "),s=t+r,a=e.isFunction(h[t])?h[t]:i[h[t]];o[s]=e.bind(a,i)}),r=e.extend(r,o)}),r}};return e.extend(i,{behaviorsLookup:function(){throw new Error("You must define where your behaviors are stored.See https://github.com/marionettejs/backbone.marionette/blob/master/docs/marionette.behaviors.md#behaviorslookup")},getBehaviorClass:function(t,n){return t.behaviorClass?t.behaviorClass:e.isFunction(i.behaviorsLookup)?i.behaviorsLookup.apply(this,arguments)[n]:i.behaviorsLookup[n]},parseBehaviors:function(t,n){return e.chain(n).map(function(n,r){var s=i.getBehaviorClass(n,r),o=new s(n,t),h=i.parseBehaviors(t,e.result(o,"behaviors"));return[o].concat(h)}).flatten().value()},wrap:function(t,i,r){e.each(r,function(r){t[r]=e.partial(n[r],t[r],i)})}}),i}(s,i),s.AppRouter=e.Router.extend({constructor:function(t){e.Router.apply(this,arguments),this.options=t||{};var i=this.getOption("appRoutes"),n=this._getController();this.processAppRoutes(n,i),this.on("route",this._processOnRoute,this)},appRoute:function(t,e){var i=this._getController();this._addAppRoute(i,t,e)},_processOnRoute:function(t,e){var n=i.invert(this.appRoutes)[t];i.isFunction(this.onRoute)&&this.onRoute(t,n,e)},processAppRoutes:function(t,e){if(e){var n=i.keys(e).reverse();i.each(n,function(i){this._addAppRoute(t,i,e[i])},this)}},_getController:function(){return this.getOption("controller")},_addAppRoute:function(t,e,r){var s=t[r];s||n('Method "'+r+'" was not found on the controller'),this.route(e,r,i.bind(s,t))},getOption:s.proxyGetOption}),s.Application=function(t){this._initRegionManager(),this._initCallbacks=new s.Callbacks;var n=e.Wreqr.radio.channel("global");this.vent=n.vent,this.commands=n.commands,this.reqres=n.reqres,this.submodules={},i.extend(this,t)},i.extend(s.Application.prototype,e.Events,{execute:function(){this.commands.execute.apply(this.commands,arguments)},request:function(){return this.reqres.request.apply(this.reqres,arguments)},addInitializer:function(t){this._initCallbacks.add(t)},start:function(t){this.triggerMethod("before:start",t),this._initCallbacks.run(t,this),this.triggerMethod("start",t)},addRegions:function(t){return this._regionManager.addRegions(t)},emptyRegions:function(){this._regionManager.emptyRegions()},removeRegion:function(t){this._regionManager.removeRegion(t)},getRegion:function(t){return this._regionManager.get(t)},getRegions:function(){return this._regionManager.getRegions()},module:function(t,e){var i=s.Module.getClass(e),n=o.call(arguments);return n.unshift(this),i.create.apply(i,n)},_initRegionManager:function(){this._regionManager=new s.RegionManager,this.listenTo(this._regionManager,"before:add:region",function(t){this.triggerMethod("before:add:region",t)}),this.listenTo(this._regionManager,"add:region",function(t,e){this[t]=e,this.triggerMethod("add:region",t,e)}),this.listenTo(this._regionManager,"before:remove:region",function(t){this.triggerMethod("before:remove:region",t)}),this.listenTo(this._regionManager,"remove:region",function(t,e){delete this[t],this.triggerMethod("remove:region",t,e)})},triggerMethod:s.triggerMethod}),s.Application.extend=s.extend,s.Module=function(t,e,n){this.moduleName=t,this.options=i.extend({},this.options,n),this.initialize=n.initialize||this.initialize,this.submodules={},this._setupInitializersAndFinalizers(),this.app=e,this.startWithParent=!0,i.isFunction(this.initialize)&&this.initialize(t,e,this.options)
},s.Module.extend=s.extend,i.extend(s.Module.prototype,e.Events,{initialize:function(){},addInitializer:function(t){this._initializerCallbacks.add(t)},addFinalizer:function(t){this._finalizerCallbacks.add(t)},start:function(t){this._isInitialized||(i.each(this.submodules,function(e){e.startWithParent&&e.start(t)}),this.triggerMethod("before:start",t),this._initializerCallbacks.run(t,this),this._isInitialized=!0,this.triggerMethod("start",t))},stop:function(){this._isInitialized&&(this._isInitialized=!1,this.triggerMethod("before:stop"),i.each(this.submodules,function(t){t.stop()}),this._finalizerCallbacks.run(void 0,this),this._initializerCallbacks.reset(),this._finalizerCallbacks.reset(),this.triggerMethod("stop"))},addDefinition:function(t,e){this._runModuleDefinition(t,e)},_runModuleDefinition:function(t,n){if(t){var r=i.flatten([this,this.app,e,s,e.$,i,n]);t.apply(this,r)}},_setupInitializersAndFinalizers:function(){this._initializerCallbacks=new s.Callbacks,this._finalizerCallbacks=new s.Callbacks},triggerMethod:s.triggerMethod}),i.extend(s.Module,{create:function(t,e,n){var r=t,s=o.call(arguments);s.splice(0,3),e=e.split(".");var h=e.length,a=[];return a[h-1]=n,i.each(e,function(e,i){var o=r;r=this._getModule(o,e,t,n),this._addModuleDefinition(o,r,a[i],s)},this),r},_getModule:function(t,e,n,r){var s=i.extend({},r),o=this.getClass(r),h=t[e];return h||(h=new o(e,n,s),t[e]=h,t.submodules[e]=h),h},getClass:function(t){var e=s.Module;return t?t.prototype instanceof e?t:t.moduleClass||e:e},_addModuleDefinition:function(t,e,i,n){var r=this._getDefine(i),s=this._getStartWithParent(i,e);r&&e.addDefinition(r,n),this._addStartWithParent(t,e,s)},_getStartWithParent:function(t,e){var n;return i.isFunction(t)&&t.prototype instanceof s.Module?(n=e.constructor.prototype.startWithParent,i.isUndefined(n)?!0:n):i.isObject(t)?(n=t.startWithParent,i.isUndefined(n)?!0:n):!0},_getDefine:function(t){return!i.isFunction(t)||t.prototype instanceof s.Module?i.isObject(t)?t.define:null:t},_addStartWithParent:function(t,e,i){e.startWithParent=e.startWithParent&&i,e.startWithParent&&!e.startWithParentIsConfigured&&(e.startWithParentIsConfigured=!0,t.addInitializer(function(t){e.startWithParent&&e.start(t)}))}}),s});