!function(t,e){if("function"==typeof define&&define.amd)define(["backbone","underscore","backbone.wreqr","backbone.babysitter"],function(i,n){return t.Marionette=e(t,i,n)});else if("undefined"!=typeof exports){var i=require("backbone"),n=require("underscore");require("backbone.wreqr"),require("backbone.babysitter"),module.exports=e(t,i,n)}else t.Marionette=e(t,t.Backbone,t._)}(this,function(t,e,i){function n(t,e){var i=new Error(t);throw i.name=e||"Error",i}var r=t.Marionette,o=e.Marionette={};o.VERSION="2.0.3",o.noConflict=function(){return t.Marionette=r,this},o.Deferred=e.$.Deferred;var s=Array.prototype.slice;return o.extend=e.Model.extend,o.getOption=function(t,e){if(t&&e){var i;return i=t.options&&void 0!==t.options[e]?t.options[e]:t[e]}},o.proxyGetOption=function(t){return o.getOption(this,t)},o.normalizeMethods=function(t){var e,n={};return i.each(t,function(t,r){e=t,i.isFunction(e)||(e=this[e]),e&&(n[r]=e)},this),n},o.normalizeUIKeys=function(t,e){return"undefined"!=typeof t?(i.each(i.keys(t),function(i){var n=/@ui.[a-zA-Z_$0-9]*/g;i.match(n)&&(t[i.replace(n,function(t){return e[t.slice(4)]})]=t[i],delete t[i])}),t):void 0},o.actAsCollection=function(t,e){var n=["forEach","each","map","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","toArray","first","initial","rest","last","without","isEmpty","pluck"];i.each(n,function(n){t[n]=function(){var t=i.values(i.result(this,e)),r=[t].concat(i.toArray(arguments));return i[n].apply(i,r)}})},o.triggerMethod=function(){function t(t,e,i){return i.toUpperCase()}var e=/(^|:)(\w)/gi,n=function(n){var r,o="on"+n.replace(e,t),s=this[o];return i.isFunction(s)&&(r=s.apply(this,i.tail(arguments))),i.isFunction(this.trigger)&&this.trigger.apply(this,arguments),r};return n}(),o.MonitorDOMRefresh=function(t){function e(t){t._isShown=!0,r(t)}function n(t){t._isRendered=!0,r(t)}function r(t){t._isShown&&t._isRendered&&o(t)&&i.isFunction(t.triggerMethod)&&t.triggerMethod("dom:refresh")}function o(e){return t.contains(e.el)}return function(t){t.listenTo(t,"show",function(){e(t)}),t.listenTo(t,"render",function(){n(t)})}}(document.documentElement),function(t){function e(t,e,r,o){var s=o.split(/\s+/);i.each(s,function(i){var o=t[i];o||n('Method "'+i+'" was configured as an event handler, but does not exist.'),t.listenTo(e,r,o)})}function r(t,e,i,n){t.listenTo(e,i,n)}function o(t,e,n,r){var o=r.split(/\s+/);i.each(o,function(i){var r=t[i];t.stopListening(e,n,r)})}function s(t,e,i,n){t.stopListening(e,i,n)}function h(t,e,n,r,o){e&&n&&(i.isFunction(n)&&(n=n.call(t)),i.each(n,function(n,s){i.isFunction(n)?r(t,e,s,n):o(t,e,s,n)}))}t.bindEntityEvents=function(t,i,n){h(t,i,n,r,e)},t.unbindEntityEvents=function(t,e,i){h(t,e,i,s,o)},t.proxyBindEntityEvents=function(e,i){return t.bindEntityEvents(this,e,i)},t.proxyUnbindEntityEvents=function(e,i){return t.unbindEntityEvents(this,e,i)}}(o),o.Callbacks=function(){this._deferred=o.Deferred(),this._callbacks=[]},i.extend(o.Callbacks.prototype,{add:function(t,e){var n=i.result(this._deferred,"promise");this._callbacks.push({cb:t,ctx:e}),n.then(function(i){e&&(i.context=e),t.call(i.context,i.options)})},run:function(t,e){this._deferred.resolve({options:t,context:e})},reset:function(){var t=this._callbacks;this._deferred=o.Deferred(),this._callbacks=[],i.each(t,function(t){this.add(t.cb,t.ctx)},this)}}),o.Controller=function(t){this.options=t||{},i.isFunction(this.initialize)&&this.initialize(this.options)},o.Controller.extend=o.extend,i.extend(o.Controller.prototype,e.Events,{destroy:function(){var t=Array.prototype.slice.call(arguments);this.triggerMethod.apply(this,["before:destroy"].concat(t)),this.triggerMethod.apply(this,["destroy"].concat(t)),this.stopListening(),this.off()},triggerMethod:o.triggerMethod,getOption:o.proxyGetOption}),o.Region=function(t){if(this.options=t||{},this.el=this.getOption("el"),this.el=this.el instanceof e.$?this.el[0]:this.el,this.el||n('An "el" must be specified for a region.',"NoElError"),this.$el=this.getEl(this.el),this.initialize){var i=Array.prototype.slice.apply(arguments);this.initialize.apply(this,i)}},i.extend(o.Region,{buildRegion:function(t,r){var o=i.isString(t),s=i.isString(t.selector),h=i.isUndefined(t.regionClass),a=i.isFunction(t);a||o||s||n("Region must be specified as a Region class,a selector string or an object with selector property");var l,d;o&&(l=t),t.selector&&(l=t.selector,delete t.selector),a&&(d=t),!a&&h&&(d=r),t.regionClass&&(d=t.regionClass,delete t.regionClass),(o||a)&&(t={}),t.el=l;var c=new d(t);return t.parentEl&&(c.getEl=function(n){if(i.isObject(n))return e.$(n);var r=t.parentEl;return i.isFunction(r)&&(r=r()),r.find(n)}),c}}),i.extend(o.Region.prototype,e.Events,{show:function(t,e){this._ensureElement();var n=e||{},r=t!==this.currentView,o=!!n.preventDestroy,s=!!n.forceShow,h=!!this.currentView,a=!o&&r;a&&this.empty();var l=r||s;return l?(t.once("destroy",i.bind(this.empty,this)),t.render(),h&&this.triggerMethod("before:swap",t),this.triggerMethod("before:show",t),i.isFunction(t.triggerMethod)?t.triggerMethod("before:show"):this.triggerMethod.call(t,"before:show"),this.attachHtml(t),this.currentView=t,h&&this.triggerMethod("swap",t),this.triggerMethod("show",t),i.isFunction(t.triggerMethod)?t.triggerMethod("show"):this.triggerMethod.call(t,"show"),this):this},_ensureElement:function(){i.isObject(this.el)||(this.$el=this.getEl(this.el),this.el=this.$el[0]),this.$el&&0!==this.$el.length||n('An "el" '+this.$el.selector+" must exist in DOM")},getEl:function(t){return e.$(t)},attachHtml:function(t){this.el.innerHTML="",this.el.appendChild(t.el)},empty:function(){var t=this.currentView;t&&(this.triggerMethod("before:empty",t),this._destroyView(),this.triggerMethod("empty",t),delete this.currentView)},_destroyView:function(){var t=this.currentView;t.destroy&&!t.isDestroyed?t.destroy():t.remove&&t.remove()},attachView:function(t){this.currentView=t},reset:function(){this.empty(),this.$el&&(this.el=this.$el.selector),delete this.$el},getOption:o.proxyGetOption,triggerMethod:o.triggerMethod}),o.Region.extend=o.extend,o.RegionManager=function(t){var e=t.Controller.extend({constructor:function(e){this._regions={},t.Controller.call(this,e)},addRegions:function(t,e){var n={};return i.each(t,function(t,r){i.isString(t)&&(t={selector:t}),t.selector&&(t=i.defaults({},t,e));var o=this.addRegion(r,t);n[r]=o},this),n},addRegion:function(e,n){var r,o=i.isObject(n),s=i.isString(n),h=!!n.selector;return r=s||o&&h?t.Region.buildRegion(n,t.Region):i.isFunction(n)?t.Region.buildRegion(n,t.Region):n,this.triggerMethod("before:add:region",e,r),this._store(e,r),this.triggerMethod("add:region",e,r),r},get:function(t){return this._regions[t]},getRegions:function(){return i.clone(this._regions)},removeRegion:function(t){var e=this._regions[t];this._remove(t,e)},removeRegions:function(){i.each(this._regions,function(t,e){this._remove(e,t)},this)},emptyRegions:function(){i.each(this._regions,function(t){t.empty()},this)},destroy:function(){this.removeRegions(),t.Controller.prototype.destroy.apply(this,arguments)},_store:function(t,e){this._regions[t]=e,this._setLength()},_remove:function(t,e){this.triggerMethod("before:remove:region",t,e),e.empty(),e.stopListening(),delete this._regions[t],this._setLength(),this.triggerMethod("remove:region",t,e)},_setLength:function(){this.length=i.size(this._regions)}});return t.actAsCollection(e.prototype,"_regions"),e}(o),o.TemplateCache=function(t){this.templateId=t},i.extend(o.TemplateCache,{templateCaches:{},get:function(t){var e=this.templateCaches[t];return e||(e=new o.TemplateCache(t),this.templateCaches[t]=e),e.load()},clear:function(){var t,e=s.call(arguments),i=e.length;if(i>0)for(t=0;i>t;t++)delete this.templateCaches[e[t]];else this.templateCaches={}}}),i.extend(o.TemplateCache.prototype,{load:function(){if(this.compiledTemplate)return this.compiledTemplate;var t=this.loadTemplate(this.templateId);return this.compiledTemplate=this.compileTemplate(t),this.compiledTemplate},loadTemplate:function(t){var i=e.$(t).html();return i&&0!==i.length||n('Could not find template: "'+t+'"',"NoTemplateError"),i},compileTemplate:function(t){return i.template(t)}}),o.Renderer={render:function(t,e){t||n("Cannot render the template since its false, null or undefined.","TemplateNotFoundError");var i;return(i="function"==typeof t?t:o.TemplateCache.get(t))(e)}},o.View=e.View.extend({constructor:function(t){i.bindAll(this,"render"),this.options=i.extend({},i.result(this,"options"),i.isFunction(t)?t.call(this):t),this.events=this.normalizeUIKeys(i.result(this,"events")),i.isObject(this.behaviors)&&new o.Behaviors(this),e.View.apply(this,arguments),o.MonitorDOMRefresh(this),this.listenTo(this,"show",this.onShowCalled)},getTemplate:function(){return this.getOption("template")},mixinTemplateHelpers:function(t){t=t||{};var e=this.getOption("templateHelpers");return i.isFunction(e)&&(e=e.call(this)),i.extend(t,e)},normalizeUIKeys:function(t){var e=i.result(this,"ui"),n=i.result(this,"_uiBindings");return o.normalizeUIKeys(t,n||e)},configureTriggers:function(){if(this.triggers){var t={},e=this.normalizeUIKeys(i.result(this,"triggers"));return i.each(e,function(e,n){var r=i.isObject(e),o=r?e.event:e;t[n]=function(t){if(t){var i=t.preventDefault,n=t.stopPropagation,s=r?e.preventDefault:i,h=r?e.stopPropagation:n;s&&i&&i.apply(t),h&&n&&n.apply(t)}var a={view:this,model:this.model,collection:this.collection};this.triggerMethod(o,a)}},this),t}},delegateEvents:function(t){this._delegateDOMEvents(t),this.bindEntityEvents(this.model,this.getOption("modelEvents")),this.bindEntityEvents(this.collection,this.getOption("collectionEvents"))},_delegateDOMEvents:function(t){t=t||this.events,i.isFunction(t)&&(t=t.call(this)),t=this.normalizeUIKeys(t);var n={},r=i.result(this,"behaviorEvents")||{},o=this.configureTriggers();i.extend(n,r,t,o),e.View.prototype.delegateEvents.call(this,n)},undelegateEvents:function(){var t=Array.prototype.slice.call(arguments);e.View.prototype.undelegateEvents.apply(this,t),this.unbindEntityEvents(this.model,this.getOption("modelEvents")),this.unbindEntityEvents(this.collection,this.getOption("collectionEvents"))},onShowCalled:function(){},_ensureViewIsIntact:function(){if(this.isDestroyed){var t=new Error("Cannot use a view thats already been destroyed.");throw t.name="ViewDestroyedError",t}},destroy:function(){if(!this.isDestroyed){var t=Array.prototype.slice.call(arguments);this.triggerMethod.apply(this,["before:destroy"].concat(t)),this.isDestroyed=!0,this.triggerMethod.apply(this,["destroy"].concat(t)),this.unbindUIElements(),this.remove()}},bindUIElements:function(){if(this.ui){this._uiBindings||(this._uiBindings=this.ui);var t=i.result(this,"_uiBindings");this.ui={},i.each(i.keys(t),function(e){var i=t[e];this.ui[e]=this.$(i)},this)}},unbindUIElements:function(){this.ui&&this._uiBindings&&(i.each(this.ui,function(t,e){delete this.ui[e]},this),this.ui=this._uiBindings,delete this._uiBindings)},triggerMethod:o.triggerMethod,normalizeMethods:o.normalizeMethods,getOption:o.proxyGetOption,bindEntityEvents:o.proxyBindEntityEvents,unbindEntityEvents:o.proxyUnbindEntityEvents}),o.ItemView=o.View.extend({constructor:function(){o.View.apply(this,arguments)},serializeData:function(){var t={};return this.model?t=this.model.toJSON():this.collection&&(t={items:this.collection.toJSON()}),t},render:function(){this._ensureViewIsIntact(),this.triggerMethod("before:render",this);var t=this.serializeData();t=this.mixinTemplateHelpers(t);var e=this.getTemplate(),i=o.Renderer.render(e,t);return this.attachElContent(i),this.bindUIElements(),this.triggerMethod("render",this),this},attachElContent:function(t){return this.$el.html(t),this},destroy:function(){this.isDestroyed||o.View.prototype.destroy.apply(this,arguments)}}),o.CollectionView=o.View.extend({childViewEventPrefix:"childview",constructor:function(t){var e=t||{};this.sort=i.isUndefined(e.sort)?!0:e.sort,this._initChildViewStorage(),o.View.apply(this,arguments),this._initialEvents(),this.initRenderBuffer()},initRenderBuffer:function(){this.elBuffer=document.createDocumentFragment(),this._bufferedChildren=[]},startBuffering:function(){this.initRenderBuffer(),this.isBuffering=!0},endBuffering:function(){this.isBuffering=!1,this._triggerBeforeShowBufferedChildren(),this.attachBuffer(this,this.elBuffer),this._triggerShowBufferedChildren(),this.initRenderBuffer()},_triggerBeforeShowBufferedChildren:function(){this._isShown&&i.invoke(this._bufferedChildren,"triggerMethod","before:show")},_triggerShowBufferedChildren:function(){this._isShown&&(i.each(this._bufferedChildren,function(t){i.isFunction(t.triggerMethod)?t.triggerMethod("show"):o.triggerMethod.call(t,"show")}),this._bufferedChildren=[])},_initialEvents:function(){this.collection&&(this.listenTo(this.collection,"add",this._onCollectionAdd),this.listenTo(this.collection,"remove",this._onCollectionRemove),this.listenTo(this.collection,"reset",this.render),this.sort&&this.listenTo(this.collection,"sort",this._sortViews))},_onCollectionAdd:function(t){this.destroyEmptyView();var e=this.getChildView(t),i=this.collection.indexOf(t);this.addChild(t,e,i)},_onCollectionRemove:function(t){var e=this.children.findByModel(t);this.removeChildView(e),this.checkEmpty()},onShowCalled:function(){this.children.each(function(t){i.isFunction(t.triggerMethod)?t.triggerMethod("show"):o.triggerMethod.call(t,"show")})},render:function(){return this._ensureViewIsIntact(),this.triggerMethod("before:render",this),this._renderChildren(),this.triggerMethod("render",this),this},_sortViews:function(){var t=this.collection.find(function(t,e){var i=this.children.findByModel(t);return i&&i._index!==e},this);t&&this.render()},_renderChildren:function(){this.destroyEmptyView(),this.destroyChildren(),this.isEmpty(this.collection)?this.showEmptyView():(this.triggerMethod("before:render:collection",this),this.startBuffering(),this.showCollection(),this.endBuffering(),this.triggerMethod("render:collection",this))},showCollection:function(){var t;this.collection.each(function(e,i){t=this.getChildView(e),this.addChild(e,t,i)},this)},showEmptyView:function(){var t=this.getEmptyView();if(t&&!this._showingEmptyView){this.triggerMethod("before:render:empty"),this._showingEmptyView=!0;var i=new e.Model;this.addEmptyView(i,t),this.triggerMethod("render:empty")}},destroyEmptyView:function(){this._showingEmptyView&&(this.destroyChildren(),delete this._showingEmptyView)},getEmptyView:function(){return this.getOption("emptyView")},addEmptyView:function(t,e){var n=this.getOption("emptyViewOptions")||this.getOption("childViewOptions");i.isFunction(n)&&(n=n.call(this));var r=this.buildChildView(t,e,n);this._isShown&&this.triggerMethod.call(r,"before:show"),this.children.add(r),this.renderChildView(r,-1),this._isShown&&this.triggerMethod.call(r,"show")},getChildView:function(){var t=this.getOption("childView");return t||n('A "childView" must be specified',"NoChildViewError"),t},addChild:function(t,e,n){var r=this.getOption("childViewOptions");i.isFunction(r)&&(r=r.call(this,t,n));var o=this.buildChildView(t,e,r);return this._updateIndices(o,!0,n),this._addChildView(o,n),o},_updateIndices:function(t,e,i){this.sort&&(e?(t._index=i,this.children.each(function(e){e._index>=t._index&&e._index++})):this.children.each(function(e){e._index>=t._index&&e._index--}))},_addChildView:function(t,e){this.proxyChildEvents(t),this.triggerMethod("before:add:child",t),this.children.add(t),this.renderChildView(t,e),this._isShown&&!this.isBuffering&&(i.isFunction(t.triggerMethod)?t.triggerMethod("show"):o.triggerMethod.call(t,"show")),this.triggerMethod("add:child",t)},renderChildView:function(t,e){t.render(),this.attachHtml(this,t,e)},buildChildView:function(t,e,n){var r=i.extend({model:t},n);return new e(r)},removeChildView:function(t){t&&(this.triggerMethod("before:remove:child",t),t.destroy?t.destroy():t.remove&&t.remove(),this.stopListening(t),this.children.remove(t),this.triggerMethod("remove:child",t),this._updateIndices(t,!1))},isEmpty:function(){return!this.collection||0===this.collection.length},checkEmpty:function(){this.isEmpty(this.collection)&&this.showEmptyView()},attachBuffer:function(t,e){t.$el.append(e)},attachHtml:function(t,e,i){t.isBuffering?(t.elBuffer.appendChild(e.el),t._bufferedChildren.push(e)):t._insertBefore(e,i)||t._insertAfter(e)},_insertBefore:function(t,e){var i,n=this.sort&&e<this.children.length-1;return n&&(i=this.children.find(function(t){return t._index===e+1})),i?(i.$el.before(t.el),!0):!1},_insertAfter:function(t){this.$el.append(t.el)},_initChildViewStorage:function(){this.children=new e.ChildViewContainer},destroy:function(){this.isDestroyed||(this.triggerMethod("before:destroy:collection"),this.destroyChildren(),this.triggerMethod("destroy:collection"),o.View.prototype.destroy.apply(this,arguments))},destroyChildren:function(){this.children.each(this.removeChildView,this),this.checkEmpty()},proxyChildEvents:function(t){var e=this.getOption("childViewEventPrefix");this.listenTo(t,"all",function(){var n=Array.prototype.slice.call(arguments),r=n[0],o=this.normalizeMethods(i.result(this,"childEvents"));n[0]=e+":"+r,n.splice(1,0,t),"undefined"!=typeof o&&i.isFunction(o[r])&&o[r].apply(this,n.slice(1)),this.triggerMethod.apply(this,n)},this)}}),o.CompositeView=o.CollectionView.extend({constructor:function(){o.CollectionView.apply(this,arguments)},_initialEvents:function(){this.once("render",function(){this.collection&&(this.listenTo(this.collection,"add",this._onCollectionAdd),this.listenTo(this.collection,"remove",this._onCollectionRemove),this.listenTo(this.collection,"reset",this._renderChildren),this.sort&&this.listenTo(this.collection,"sort",this._sortViews))})},getChildView:function(){var t=this.getOption("childView")||this.constructor;return t||n('A "childView" must be specified',"NoChildViewError"),t},serializeData:function(){var t={};return this.model&&(t=this.model.toJSON()),t},render:function(){return this._ensureViewIsIntact(),this.isRendered=!0,this.resetChildViewContainer(),this.triggerMethod("before:render",this),this._renderRoot(),this._renderChildren(),this.triggerMethod("render",this),this},_renderChildren:function(){this.isRendered&&o.CollectionView.prototype._renderChildren.call(this)},_renderRoot:function(){var t={};t=this.serializeData(),t=this.mixinTemplateHelpers(t),this.triggerMethod("before:render:template");var e=this.getTemplate(),i=o.Renderer.render(e,t);this.attachElContent(i),this.bindUIElements(),this.triggerMethod("render:template")},attachElContent:function(t){return this.$el.html(t),this},attachBuffer:function(t,e){var i=this.getChildViewContainer(t);i.append(e)},_insertAfter:function(t){var e=this.getChildViewContainer(this);e.append(t.el)},getChildViewContainer:function(t){if("$childViewContainer"in t)return t.$childViewContainer;var e,r=o.getOption(t,"childViewContainer");if(r){var s=i.isFunction(r)?r.call(t):r;e="@"===s.charAt(0)&&t.ui?t.ui[s.substr(4)]:t.$(s),e.length<=0&&n('The specified "childViewContainer" was not found: '+t.childViewContainer,"ChildViewContainerMissingError")}else e=t.$el;return t.$childViewContainer=e,e},resetChildViewContainer:function(){this.$childViewContainer&&delete this.$childViewContainer}}),o.LayoutView=o.ItemView.extend({regionClass:o.Region,constructor:function(t){t=t||{},this._firstRender=!0,this._initializeRegions(t),o.ItemView.call(this,t)},render:function(){return this._ensureViewIsIntact(),this._firstRender?this._firstRender=!1:this._reInitializeRegions(),o.ItemView.prototype.render.apply(this,arguments)},destroy:function(){this.isDestroyed||(this.regionManager.destroy(),o.ItemView.prototype.destroy.apply(this,arguments))},addRegion:function(t,e){this.triggerMethod("before:region:add",t);var i={};return i[t]=e,this._buildRegions(i)[t]},addRegions:function(t){return this.regions=i.extend({},this.regions,t),this._buildRegions(t)},removeRegion:function(t){return this.triggerMethod("before:region:remove",t),delete this.regions[t],this.regionManager.removeRegion(t)},getRegion:function(t){return this.regionManager.get(t)},getRegions:function(){return this.regionManager.getRegions()},_buildRegions:function(t){var e=this,i={regionClass:this.getOption("regionClass"),parentEl:function(){return e.$el}};return this.regionManager.addRegions(t,i)},_initializeRegions:function(t){var e;this._initRegionManager(),e=i.isFunction(this.regions)?this.regions(t):this.regions||{};var n=this.getOption.call(t,"regions");i.isFunction(n)&&(n=n.call(this,t)),i.extend(e,n),this.addRegions(e)},_reInitializeRegions:function(){this.regionManager.emptyRegions(),this.regionManager.each(function(t){t.reset()})},getRegionManager:function(){return new o.RegionManager},_initRegionManager:function(){this.regionManager=this.getRegionManager(),this.listenTo(this.regionManager,"before:add:region",function(t){this.triggerMethod("before:add:region",t)}),this.listenTo(this.regionManager,"add:region",function(t,e){this[t]=e,this.triggerMethod("add:region",t,e)}),this.listenTo(this.regionManager,"before:remove:region",function(t){this.triggerMethod("before:remove:region",t)}),this.listenTo(this.regionManager,"remove:region",function(t,e){delete this[t],this.triggerMethod("remove:region",t,e)})}}),o.Behavior=function(t,e){function i(e,i){this.view=i,this.defaults=t.result(this,"defaults")||{},this.options=t.extend({},this.defaults,e),this.$=function(){return this.view.$.apply(this.view,arguments)},this.initialize.apply(this,arguments)}return t.extend(i.prototype,e.Events,{initialize:function(){},destroy:function(){this.stopListening()},triggerMethod:o.triggerMethod,getOption:o.proxyGetOption,bindEntityEvents:o.proxyBindEntityEvents,unbindEntityEvents:o.proxyUnbindEntityEvents}),i.extend=o.extend,i}(i,e),o.Behaviors=function(t,e){function i(t,r){r=i.parseBehaviors(t,r||e.result(t,"behaviors")),i.wrap(t,r,e.keys(n))}var n={setElement:function(t,i){t.apply(this,e.tail(arguments,2)),e.each(i,function(t){t.$el=this.$el},this)},destroy:function(t,i){var n=e.tail(arguments,2);t.apply(this,n),e.invoke(i,"destroy",n)},bindUIElements:function(t,i){t.apply(this),e.invoke(i,t)},unbindUIElements:function(t,i){t.apply(this),e.invoke(i,t)},triggerMethod:function(t,i){var n=e.tail(arguments,2);t.apply(this,n),e.each(i,function(e){t.apply(e,n)})},delegateEvents:function(i,n){var r=e.tail(arguments,2);i.apply(this,r),e.each(n,function(e){t.bindEntityEvents(e,this.model,t.getOption(e,"modelEvents")),t.bindEntityEvents(e,this.collection,t.getOption(e,"collectionEvents"))},this)},undelegateEvents:function(i,n){var r=e.tail(arguments,2);i.apply(this,r),e.each(n,function(e){t.unbindEntityEvents(e,this.model,t.getOption(e,"modelEvents")),t.unbindEntityEvents(e,this.collection,t.getOption(e,"collectionEvents"))},this)},behaviorEvents:function(i,n){var r={},o=e.result(this,"ui");return e.each(n,function(i,n){var s={},h=e.clone(e.result(i,"events"))||{},a=e.result(i,"ui"),l=e.extend({},o,a);h=t.normalizeUIKeys(h,l),e.each(e.keys(h),function(t){var r=new Array(n+2).join(" "),o=t+r,a=e.isFunction(h[t])?h[t]:i[h[t]];s[o]=e.bind(a,i)}),r=e.extend(r,s)}),r}};return e.extend(i,{behaviorsLookup:function(){throw new Error("You must define where your behaviors are stored.See https://github.com/marionettejs/backbone.marionette/blob/master/docs/marionette.behaviors.md#behaviorslookup")},getBehaviorClass:function(t,n){return t.behaviorClass?t.behaviorClass:e.isFunction(i.behaviorsLookup)?i.behaviorsLookup.apply(this,arguments)[n]:i.behaviorsLookup[n]},parseBehaviors:function(t,n){return e.chain(n).map(function(n,r){var o=i.getBehaviorClass(n,r),s=new o(n,t),h=i.parseBehaviors(t,e.result(s,"behaviors"));return[s].concat(h)}).flatten().value()},wrap:function(t,i,r){e.each(r,function(r){t[r]=e.partial(n[r],t[r],i)})}}),i}(o,i),o.AppRouter=e.Router.extend({constructor:function(t){e.Router.apply(this,arguments),this.options=t||{};var i=this.getOption("appRoutes"),n=this._getController();this.processAppRoutes(n,i),this.on("route",this._processOnRoute,this)},appRoute:function(t,e){var i=this._getController();this._addAppRoute(i,t,e)},_processOnRoute:function(t,e){var n=i.invert(this.appRoutes)[t];i.isFunction(this.onRoute)&&this.onRoute(t,n,e)},processAppRoutes:function(t,e){if(e){var n=i.keys(e).reverse();i.each(n,function(i){this._addAppRoute(t,i,e[i])},this)}},_getController:function(){return this.getOption("controller")},_addAppRoute:function(t,e,r){var o=t[r];o||n('Method "'+r+'" was not found on the controller'),this.route(e,r,i.bind(o,t))},getOption:o.proxyGetOption}),o.Application=function(t){this._initRegionManager(),this._initCallbacks=new o.Callbacks;var n=e.Wreqr.radio.channel("global");this.vent=n.vent,this.commands=n.commands,this.reqres=n.reqres,this.submodules={},i.extend(this,t)},i.extend(o.Application.prototype,e.Events,{execute:function(){this.commands.execute.apply(this.commands,arguments)},request:function(){return this.reqres.request.apply(this.reqres,arguments)},addInitializer:function(t){this._initCallbacks.add(t)},start:function(t){this.triggerMethod("before:start",t),this._initCallbacks.run(t,this),this.triggerMethod("start",t)},addRegions:function(t){return this._regionManager.addRegions(t)},emptyRegions:function(){this._regionManager.emptyRegions()},removeRegion:function(t){this._regionManager.removeRegion(t)},getRegion:function(t){return this._regionManager.get(t)},getRegions:function(){return this._regionManager.getRegions()},module:function(t,e){var i=o.Module.getClass(e),n=s.call(arguments);return n.unshift(this),i.create.apply(i,n)},_initRegionManager:function(){this._regionManager=new o.RegionManager,this.listenTo(this._regionManager,"before:add:region",function(t){this.triggerMethod("before:add:region",t)}),this.listenTo(this._regionManager,"add:region",function(t,e){this[t]=e,this.triggerMethod("add:region",t,e)}),this.listenTo(this._regionManager,"before:remove:region",function(t){this.triggerMethod("before:remove:region",t)}),this.listenTo(this._regionManager,"remove:region",function(t,e){delete this[t],this.triggerMethod("remove:region",t,e)})},triggerMethod:o.triggerMethod}),o.Application.extend=o.extend,o.Module=function(t,e,n){this.moduleName=t,this.options=i.extend({},this.options,n),this.initialize=n.initialize||this.initialize,this.submodules={},this._setupInitializersAndFinalizers(),this.app=e,this.startWithParent=!0,i.isFunction(this.initialize)&&this.initialize(t,e,this.options)},o.Module.extend=o.extend,i.extend(o.Module.prototype,e.Events,{initialize:function(){},addInitializer:function(t){this._initializerCallbacks.add(t)},addFinalizer:function(t){this._finalizerCallbacks.add(t)},start:function(t){this._isInitialized||(i.each(this.submodules,function(e){e.startWithParent&&e.start(t)}),this.triggerMethod("before:start",t),this._initializerCallbacks.run(t,this),this._isInitialized=!0,this.triggerMethod("start",t))},stop:function(){this._isInitialized&&(this._isInitialized=!1,this.triggerMethod("before:stop"),i.each(this.submodules,function(t){t.stop()}),this._finalizerCallbacks.run(void 0,this),this._initializerCallbacks.reset(),this._finalizerCallbacks.reset(),this.triggerMethod("stop"))},addDefinition:function(t,e){this._runModuleDefinition(t,e)},_runModuleDefinition:function(t,n){if(t){var r=i.flatten([this,this.app,e,o,e.$,i,n]);t.apply(this,r)}},_setupInitializersAndFinalizers:function(){this._initializerCallbacks=new o.Callbacks,this._finalizerCallbacks=new o.Callbacks},triggerMethod:o.triggerMethod}),i.extend(o.Module,{create:function(t,e,n){var r=t,o=s.call(arguments);o.splice(0,3),e=e.split(".");var h=e.length,a=[];return a[h-1]=n,i.each(e,function(e,i){var s=r;r=this._getModule(s,e,t,n),this._addModuleDefinition(s,r,a[i],o)},this),r},_getModule:function(t,e,n,r){var o=i.extend({},r),s=this.getClass(r),h=t[e];return h||(h=new s(e,n,o),t[e]=h,t.submodules[e]=h),h},getClass:function(t){var e=o.Module;return t?t.prototype instanceof e?t:t.moduleClass||e:e},_addModuleDefinition:function(t,e,i,n){var r=this._getDefine(i),o=this._getStartWithParent(i,e);r&&e.addDefinition(r,n),this._addStartWithParent(t,e,o)},_getStartWithParent:function(t,e){var n;return i.isFunction(t)&&t.prototype instanceof o.Module?(n=e.constructor.prototype.startWithParent,i.isUndefined(n)?!0:n):i.isObject(t)?(n=t.startWithParent,i.isUndefined(n)?!0:n):!0},_getDefine:function(t){return!i.isFunction(t)||t.prototype instanceof o.Module?i.isObject(t)?t.define:null:t},_addStartWithParent:function(t,e,i){e.startWithParent=e.startWithParent&&i,e.startWithParent&&!e.startWithParentIsConfigured&&(e.startWithParentIsConfigured=!0,t.addInitializer(function(t){e.startWithParent&&e.start(t)}))}}),o});