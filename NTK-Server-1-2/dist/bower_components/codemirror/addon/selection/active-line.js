// CodeMirror, copyright (c) by Marijn Haverbeke and others
// Distributed under an MIT license: http://codemirror.net/LICENSE

!function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)}(function(e){function n(e){for(var n=0;n<e.state.activeLines.length;n++)e.removeLineClass(e.state.activeLines[n],"wrap",o),e.removeLineClass(e.state.activeLines[n],"background",a)}function t(e,n){if(e.length!=n.length)return!1;for(var t=0;t<e.length;t++)if(e[t]!=n[t])return!1;return!0}function i(e,i){for(var r=[],c=0;c<i.length;c++){var s=i[c];if(s.empty()){var f=e.getLineHandleVisualStart(s.head.line);r[r.length-1]!=f&&r.push(f)}}t(e.state.activeLines,r)||e.operation(function(){n(e);for(var t=0;t<r.length;t++)e.addLineClass(r[t],"wrap",o),e.addLineClass(r[t],"background",a);e.state.activeLines=r})}function r(e,n){i(e,n.ranges)}var o="CodeMirror-activeline",a="CodeMirror-activeline-background";e.defineOption("styleActiveLine",!1,function(t,o,a){var c=a&&a!=e.Init;o&&!c?(t.state.activeLines=[],i(t,t.listSelections()),t.on("beforeSelectionChange",r)):!o&&c&&(t.off("beforeSelectionChange",r),n(t),delete t.state.activeLines)})});