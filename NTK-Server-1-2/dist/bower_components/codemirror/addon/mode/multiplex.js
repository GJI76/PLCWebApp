// CodeMirror, copyright (c) by Marijn Haverbeke and others
// Distributed under an MIT license: http://codemirror.net/LICENSE

!function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)}(function(e){e.multiplexingMode=function(n){function r(e,n,r,t){if("string"==typeof n){var i=e.indexOf(n,r);return t&&i>-1?i+n.length:i}var o=n.exec(r?e.slice(r):e);return o?o.index+r+(t?o[0].length:0):-1}var t=Array.prototype.slice.call(arguments,1);return{startState:function(){return{outer:e.startState(n),innerActive:null,inner:null}},copyState:function(r){return{outer:e.copyState(n,r.outer),innerActive:r.innerActive,inner:r.innerActive&&e.copyState(r.innerActive.mode,r.inner)}},token:function(i,o){if(o.innerActive){var c=o.innerActive,l=i.string;if(!c.close&&i.sol())return o.innerActive=o.inner=null,this.token(i,o);var s=c.close?r(l,c.close,i.pos,c.parseDelimiters):-1;if(s==i.pos&&!c.parseDelimiters)return i.match(c.close),o.innerActive=o.inner=null,c.delimStyle;s>-1&&(i.string=l.slice(0,s));var a=c.mode.token(i,o.inner);return s>-1&&(i.string=l),s==i.pos&&c.parseDelimiters&&(o.innerActive=o.inner=null),c.innerStyle&&(a=a?a+" "+c.innerStyle:c.innerStyle),a}for(var u=1/0,l=i.string,v=0;v<t.length;++v){var d=t[v],s=r(l,d.open,i.pos);if(s==i.pos)return d.parseDelimiters||i.match(d.open),o.innerActive=d,o.inner=e.startState(d.mode,n.indent?n.indent(o.outer,""):0),d.delimStyle;-1!=s&&u>s&&(u=s)}1/0!=u&&(i.string=l.slice(0,u));var f=n.token(i,o.outer);return 1/0!=u&&(i.string=l),f},indent:function(r,t){var i=r.innerActive?r.innerActive.mode:n;return i.indent?i.indent(r.innerActive?r.inner:r.outer,t):e.Pass},blankLine:function(r){var i=r.innerActive?r.innerActive.mode:n;if(i.blankLine&&i.blankLine(r.innerActive?r.inner:r.outer),r.innerActive)"\n"===r.innerActive.close&&(r.innerActive=r.inner=null);else for(var o=0;o<t.length;++o){var c=t[o];"\n"===c.open&&(r.innerActive=c,r.inner=e.startState(c.mode,i.indent?i.indent(r.outer,""):0))}},electricChars:n.electricChars,innerMode:function(e){return e.inner?{state:e.inner,mode:e.innerActive.mode}:{state:e.outer,mode:n}}}}});