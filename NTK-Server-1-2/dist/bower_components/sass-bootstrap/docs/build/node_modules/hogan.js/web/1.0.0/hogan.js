/*
 *  Copyright 2011 Twitter, Inc.
 *  Licensed under the Apache License, Version 2.0 (the "License");
 *  you may not use this file except in compliance with the License.
 *  You may obtain a copy of the License at
 *
 *  http://www.apache.org/licenses/LICENSE-2.0
 *
 *  Unless required by applicable law or agreed to in writing, software
 *  distributed under the License is distributed on an "AS IS" BASIS,
 *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 *  See the License for the specific language governing permissions and
 *  limitations under the License.
 */

var HoganTemplate=function(){function n(n){this.text=n}function t(n){var t=String(null===n?"":n);return c.test(t)?t.replace(r,"&amp;").replace(e,"&lt;").replace(o,"&gt;").replace(i,"&#39;").replace(u,"&quot;"):t}n.prototype={r:function(){return""},v:t,render:function(n,t){return this.r(n,t)},rp:function(n,t,r){var e=r[n];return e?e.render(t,r):""},rs:function(n,t,r){var e="",o=n[n.length-1];if(!a(o))return e=r(n,t);for(var i=0;i<o.length;i++)n.push(o[i]),e+=r(n,t),n.pop();return e},s:function(n,t,r,e,o,i){if(a(n)&&0===n.length)return!1;e||"function"!=typeof n||(n=this.ls(n,t,r,o,i));var u=""===n||!!n;return!e&&u&&t&&t.push("object"==typeof n?n:t[t.length-1]),u},d:function(n,t,r,e){if("."===n&&a(t[t.length-2]))return t[t.length-1];for(var o=n.split("."),i=this.f(o[0],t,r,e),u=null,c=1;c<o.length;c++)i&&"object"==typeof i&&o[c]in i?(u=i,i=i[o[c]]):i="";return e&&!i?!1:(e||"function"!=typeof i||(t.push(u),i=this.lv(i,t,r),t.pop()),i)},f:function(n,t,r,e){for(var o=!1,i=null,u=!1,c=t.length-1;c>=0;c--)if(i=t[c],i&&"object"==typeof i&&n in i){o=i[n],u=!0;break}return u?(e||"function"!=typeof o||(o=this.lv(o,t,r)),o):e?!1:""},ho:function(n,t,r,e){var o=n.call(t,e,function(n){return Hogan.compile(n).render(t)}),i=Hogan.compile(o.toString()).render(t,r);return this.b=i,!1},b:"",ls:function(n,t,r,e,o){var i=t[t.length-1];if(n.length>0)return this.ho(n,i,r,this.text.substring(e,o));var u=n.call(i);return"function"==typeof u?this.ho(u,i,r,this.text.substring(e,o)):u},lv:function(n,t,r){var e=t[t.length-1];return Hogan.compile(n.call(e).toString()).render(e,r)}};var r=/&/g,e=/</g,o=/>/g,i=/\'/g,u=/\"/g,c=/[&<>\"\']/,a=Array.isArray||function(n){return"[object Array]"===Object.prototype.toString.call(n)};return n}(),Hogan=function(){function n(n){function e(){s.length>0&&(h.push(new String(s)),s="")}function o(){for(var n=!0,t=_;t<h.length;t++)if(n=h[t].tag&&b[h[t].tag]<b._v||!h[t].tag&&null==h[t].match(d),!n)return!1;return n}function i(n,t){if(e(),n&&o())for(var r=_;r<h.length;r++)h[r].tag||h.splice(r,1);else t||h.push({tag:"\n"});v=!1,_=h.length}function u(n,r){var e="="+y,o=n.indexOf(e,r),i=t(n.substring(n.indexOf("=",r)+1,o)).split(" ");return x=i[0],y=i[1],o+e.length-1}var c=n.length,a=0,f=1,l=2,g=a,p=null,s="",h=[],v=!1,m=0,_=0,x="{{",y="}}";for(m=0;c>m;m++)if(g==a)r(x,n,m)?(--m,e(),g=f):"\n"==n[m]?i(v):s+=n[m];else if(g==f){m+=x.length-1;var H=b[n[m+1]];p=H?n[m+1]:"_v",v=m,"="==p?(m=u(n,m),g=a):(H&&m++,g=l)}else r(y,n,m)?(m+=y.length-1,h.push({tag:p,n:t(s),i:"/"==p?v-1:m+1}),s="",g=a,"{"==p&&m++):s+=n[m];return i(v,!0),h}function t(n){return n.trim?n.trim():n.replace(/^\s*|\s*$/g,"")}function r(n,t,r){if(t[r]!=n[0])return!1;for(var e=1,o=n.length;o>e;e++)if(t[r+e]!=n[e])return!1;return!0}function e(n,t,r,u){for(var c=[],a=null,f=null;n.length>0;)if(f=n.shift(),"#"==f.tag||"^"==f.tag||o(f,u))r.push(f),f.nodes=e(n,f.tag,r,u),c.push(f);else{if("/"==f.tag){if(0==r.length)throw new Error("Closing tag without opener: /"+f.n);if(a=r.pop(),f.n!=a.n&&!i(f.n,a.n,u))throw new Error("Nesting error: "+a.n+" vs. "+f.n);return a.end=f.i,c}c.push(f)}if(r.length>0)throw new Error("missing closing tag: "+r.pop().n);return c}function o(n,t){for(var r=0,e=t.length;e>r;r++)if(t[r].o==n.n)return n.tag="#",!0}function i(n,t,r){for(var e=0,o=r.length;o>e;e++)if(r[e].c==n&&r[e].o==t)return!0}function u(n,t,r){var e='var c = [cx];var b = "";var _ = this;'+f(n)+"return b;";if(r.asString)return"function(cx,p){"+e+";};";var o=new HoganTemplate(t);return o.r=new Function("cx","p",e),o}function c(n){return n.replace(y,"\\\\").replace(m,'\\"').replace(_,"\\n").replace(x,"\\r")}function a(n){return~n.indexOf(".")?"d":"f"}function f(n){for(var t="",r=0,e=n.length;e>r;r++){var o=n[r].tag;"#"==o?t+=l(n[r].nodes,n[r].n,a(n[r].n),n[r].i,n[r].end):"^"==o?t+=g(n[r].nodes,n[r].n,a(n[r].n)):"<"==o||">"==o?t+=p(n[r].n):"{"==o||"&"==o?t+=s(n[r].n,a(n[r].n)):"\n"==o?t+=v("\n"):"_v"==o?t+=h(n[r].n,a(n[r].n)):void 0===o&&(t+=v(n[r]))}return t}function l(n,t,r,e,o){var i="if(_.s(_."+r+'("'+c(t)+'",c,p,1),';return i+="c,p,0,"+e+","+o+")){",i+="b += _.rs(c,p,",i+='function(c,p){ var b = "";',i+=f(n),i+="return b;});c.pop();}",i+='else{b += _.b; _.b = ""};'}function g(n,t,r){var e="if (!_.s(_."+r+'("'+c(t)+'",c,p,1),c,p,1,0,0)){';return e+=f(n),e+="};"}function p(n){return'b += _.rp("'+c(n)+'",c[c.length - 1],p);'}function s(n,t){return"b += (_."+t+'("'+c(n)+'",c,p,0));'}function h(n,t){return"b += (_.v(_."+t+'("'+c(n)+'",c,p,0)));'}function v(n){return'b += "'+c(n)+'";'}var d=/\S/,b={"#":1,"^":2,"/":3,"!":4,">":5,"<":6,"=":7,_v:8,"{":9,"&":10},m=/\"/g,_=/\n/g,x=/\r/g,y=/\\/g;return{scan:n,parse:function(n,t){return t=t||{},e(n,"",[],t.sectionTags||[])},cache:{},compile:function(t,r){r=r||{};var e=this.cache[t];return e?e:(e=u(this.parse(n(t),r),t,r),this.cache[t]=e)}}}();"undefined"!=typeof module&&module.exports?(module.exports=Hogan,module.exports.Template=HoganTemplate):"undefined"!=typeof exports&&(exports.Hogan=Hogan,exports.HoganTemplate=HoganTemplate);