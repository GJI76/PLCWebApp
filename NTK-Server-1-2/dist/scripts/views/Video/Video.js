define(["backbone","rivets","views/item/WidgetMulti","text!./template.js"],function(e,t,i,o){return i.extend({typeID:"Video",categories:["media"],className:"video",template:_.template(o),sources:[],widgetEvents:{"change .loop":"loopChange","change .continuous":"continuousChange","change .displayWidth":"setVideoDimensions","change .videosrc":"loopChange","mouseup .detachedEl":"imgMoved"},initialize:function(e){i.prototype.initialize.call(this,e),this.model.set({srcmp4:"assets/video/ball.mp4",srcogg:"assets/video/ball.ogv",ins:[{title:"Play",to:"play"},{title:"Speed",to:"speed"},{title:"Time",to:"time"},{title:"opacity",to:"opacity"}],title:"Video",play:0,playText:"Pause",toggle:0,volume:100,speed:100,time:0,loop:!1,continuous:!1,threshold:512,activeControlParameter:"left",controlParameters:[{name:"X",parameter:"left"},{name:"Y",parameter:"top"},{name:"opacity",parameter:"opacity"}],displayWidth:500,left:100,top:200,opacity:100}),this.lastTimeIn=0,this.playing=!1,this.domReady=!1},onRender:function(){i.prototype.onRender.call(this);var e=this;app.server||(this.$(".detachedEl").css("cursor","move"),this.$(".detachedEl").css("position","fixed"),this.$(".detachedEl").draggable({cursor:"move"}),this.domReady=!0,this.init=!1,$(document).ready(function(){e.setVideoDimensions()}))},onModelChange:function(e){if(this.domReady){if(!app.server&&(void 0!=e.changedAttributes().play||void 0!=e.changedAttributes().speed||void 0!=e.changedAttributes().time)){var t=parseInt(this.model.get("play"),10),i=(Math.min(parseFloat(this.model.get("volume"))/100,1),parseFloat(this.model.get("speed"))/100),o=parseFloat(this.model.get("time")),s=parseInt(this.model.get("threshold")),a=this.$(".video")[0];if(void 0!=e.changedAttributes().speed&&(a.playbackRate=i),o!=this.lastTimeIn&&void 0!=e.changedAttributes().time){var l=Math.min(o,Math.floor(a.duration));l=Math.max(l,0),a.currentTime=l}void 0!=e.changedAttributes().play&&(this.model.get("continuous")||(t>=s&&!this.playing?(a.play(),this.playing=!0,this.model.set("playText","Play")):s>t&&this.playing&&(a.pause(),this.playing=!1,this.model.set("playText","Pause"))))}this.lastTimeIn=o}},loopChange:function(){app.server||(this.$(".video")[0].loop=this.model.get("loop"))},setVideoDimensions:function(){app.server||this.$(".detachedEl").css("width",this.model.get("displayWidth")),this.$(".video")[0].loop=this.model.get("loop"),this.model.get("continuous")&&(this.playing=!0,this.$(".video")[0].play(),this.model.set("playText","Play"))},continuousChange:function(){app.server||this.model.get("continuous")&&(this.$(".video")[0].loop=this.model.get("loop"),this.$(".video")[0].play(),this.playing=!0,this.model.set("playText","Play"))},imgMoved:function(){var e=this.$(".detachedEl").offset();this.model.set("left",e.left),this.model.set("top",e.top)}})});