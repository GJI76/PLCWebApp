define(["backbone","rivets","utils/SignalChainFunctions","utils/SignalChainClasses","views/item/WidgetMulti","views/WidgetSettings","text!./template.js","jqueryknob"],function(t,i,e,n,s,o,a){return s.extend({widgetEvents:{"click .invert":"toggleInvert","click .smoothing":"toggleSmoothing","click .easing":"toggleEasing","change .smoothingAmount":"smoothingAmtChange"},ins:[],outs:[{title:"out",from:"in",to:"out"}],typeID:"AnalogIn",className:"analogIn",categories:["I/O"],template:_.template(a),initialize:function(t){s.prototype.initialize.call(this,t),this.model.set({title:"AnalogIn",easing:!1,easingAmount:30,smoothingAmount:60}),this.easingLast=0,this.signalChainFunctions.push(e.scale),this.signalChainFunctions.push(e.invert),this.signalChainFunctions.push(this.easing),this.smoother=new n.Smoother({tolerance:this.model.get("smoothingAmount")}),this.signalChainFunctions.push(this.smoother.getChainFunction()),this.localProcessSignalChain=function(){this.processSignalChain()}.bind(this),window.app.timingController.registerFrameCallback(this.localProcessSignalChain,this),this.localTimeKeeperFunc=function(t){this.timeKeeper(t)}.bind(this),window.app.timingController.registerFrameCallback(this.localTimeKeeperFunc,this)},onRender:function(){s.prototype.onRender.call(this);var t=this;this.$(".dial").knob({fgColor:"#000000",bgColor:"#ffffff",inputColor:"#000000",angleOffset:-125,angleArc:250,width:80,height:62,font:"'Helvetica Neue', sans-serif",displayInput:!1,min:0,max:1023,change:function(i){t.model.set("in",parseInt(i))}}),i.binders.knob=function(t,i){t.value=i,$(t).val(i),$(t).trigger("change")}},onRemove:function(){window.app.timingController.removeFrameCallback(this.localProcessSignalChain,this),window.app.timingController.removeFrameCallback(this.localTimeKeeperFunc,this)},toggleInvert:function(t){t.preventDefault(),t.stopPropagation(),this.model.set("invert",!this.model.get("invert"))},toggleSmoothing:function(t){t.preventDefault(),t.stopPropagation(),this.smoother.toggleActive(),this.model.set("smoothing",this.smoother.active)},toggleEasing:function(t){t.preventDefault(),t.stopPropagation(),this.model.set("easing",!this.model.get("easing"))},easing:function(t){return this.easingNew=t,this.model.get("easing")?(isNaN(this.easingLast)&&(this.easingLast=this.easingNew),this.easingLast):t},easeOutExpo:function(t,i,e,n){return e*(-Math.pow(2,-10*t/n)+1)+i},timeKeeper:function(){this.model.get("easing")?(this.easingLast=this.easeOutExpo(.17,this.easingLast,this.easingNew-this.easingLast,this.model.get("easingAmount")),Math.abs(this.easingLast-this.easingNew)<.4&&(this.easingLast=this.easingNew),isNaN(this.easingLast)&&(this.easingLast=this.easingNew)):this.easingLast=this.easingNew},smoothingAmtChange:function(){this.smoother.setBufferLength(this.model.get("smoothingAmount"))}})});