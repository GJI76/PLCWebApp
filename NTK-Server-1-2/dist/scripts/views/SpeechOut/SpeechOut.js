define(["backbone","rivets","views/item/WidgetMulti","text!./template.js","utils/SignalChainFunctions","utils/SignalChainClasses"],function(e,t,s,i){return s.extend({ins:[{title:"in1",to:"in1"},{title:"in2",to:"in2"}],outs:[{title:"out1",from:"output",to:"out1"}],widgetEvents:{"change .select_language":"updateCountry","change .voice":"updateLang","mousedown .speak":"speakStart","mouseup .speak":"speakStop"},sources:[],typeID:"SpeechOut",className:"speechout",categories:["generator"],template:_.template(i),initialize:function(e){s.prototype.initialize.call(this,e),this.model.set({title:"SpeechOut",in1:0,in2:"Hello world, this is a test",voice:"Samantha",language:6,dialect:"en-US",lang:"en-US",threshold:512,autoPlay:!0,autoCancel:!1,lastIn:-1,start_timestamp:0,continuous:!1,domReady:!1})},onRender:function(){s.prototype.onRender.call(this);var e=this;app.server||(this.$(".speak").css("cursor","pointer"),"speechSynthesis"in window?(this.voiceSelect=this.$(".voice").get(0),this.select_language=this.$(".select_language").get(0),this.select_dialect=this.$(".select_dialect").get(0),this.voiceDialects={},this.setLanguages(),this.msg=new SpeechSynthesisUtterance,this.msg.volume=1,this.msg.rate=1,this.msg.lang="en-US",window.speechSynthesis.onvoiceschanged=function(){e.voiceSelect.value||(e.loadVoices(),e.voiceSelect.value=e.model.get("voice"),e.updateLang())},this.msg.onend=function(){}):alert("Browser not supported for speech synthesis")),this.model.set("domReady",!0)},onModelChange:function(e){if(!app.server&&this.model.get("domReady")){if(this.voiceSelect.value||(this.loadVoices(),this.voiceSelect.value=this.model.get("voice"),this.updateLang()),void 0!==e.changedAttributes().in1){var t=parseFloat(this.model.get("in1")),s=this.model.get("threshold");this.model.get("lastIn")<s&&t>=s?this.speak():this.model.get("lastIn")>=s&&s>t&&this.model.get("autoCancel")&&window.speechSynthesis.cancel(),this.model.set("lastIn",t)}void 0!==e.changedAttributes().in2&&this.model.get("autoPlay")&&this.speak()}},speak:function(){var e=this;window.speechSynthesis.cancel(),this.msg.lang=this.select_dialect.value,this.msg.text=this.model.get("in2"),this.voiceSelect.value&&(this.msg.voice=window.speechSynthesis.getVoices().filter(function(t){return t.name==e.voiceSelect.value})[0]),window.speechSynthesis.speak(this.msg)},loadVoices:function(){var e=this,t=window.speechSynthesis.getVoices();t.forEach(function(t){var s=document.createElement("option");s.value=t.name,s.innerHTML=t.name,e.voiceDialects[t.name]=t.lang,e.voiceSelect.appendChild(s)})},speakStart:function(){this.model.set("in1",1023)},speakStop:function(){this.model.set("in1",0)},setLanguages:function(){this.langs=[["Afrikaans",["af-ZA"]],["Bahasa Indonesia",["id-ID"]],["Bahasa Melayu",["ms-MY"]],["Català",["ca-ES"]],["Čeština",["cs-CZ"]],["Deutsch",["de-DE"]],["English",["en-AU","Australia"],["en-CA","Canada"],["en-IN","India"],["en-NZ","New Zealand"],["en-ZA","South Africa"],["en-GB","United Kingdom"],["en-US","United States"]],["Español",["es-AR","Argentina"],["es-BO","Bolivia"],["es-CL","Chile"],["es-CO","Colombia"],["es-CR","Costa Rica"],["es-EC","Ecuador"],["es-SV","El Salvador"],["es-ES","España"],["es-US","Estados Unidos"],["es-GT","Guatemala"],["es-HN","Honduras"],["es-MX","México"],["es-NI","Nicaragua"],["es-PA","Panamá"],["es-PY","Paraguay"],["es-PE","Perú"],["es-PR","Puerto Rico"],["es-DO","República Dominicana"],["es-UY","Uruguay"],["es-VE","Venezuela"]],["Euskara",["eu-ES"]],["Français",["fr-FR"]],["Galego",["gl-ES"]],["Hrvatski",["hr_HR"]],["IsiZulu",["zu-ZA"]],["Íslenska",["is-IS"]],["Italiano",["it-IT","Italia"],["it-CH","Svizzera"]],["Magyar",["hu-HU"]],["Nederlands",["nl-NL"]],["Norsk bokmål",["nb-NO"]],["Polski",["pl-PL"]],["Português",["pt-BR","Brasil"],["pt-PT","Portugal"]],["Română",["ro-RO"]],["Slovenčina",["sk-SK"]],["Suomi",["fi-FI"]],["Svenska",["sv-SE"]],["Türkçe",["tr-TR"]],["български",["bg-BG"]],["Pусский",["ru-RU"]],["Српски",["sr-RS"]],["한국어",["ko-KR"]],["中文",["cmn-Hans-CN","普通话 (中国大陆)"],["cmn-Hans-HK","普通话 (香港)"],["cmn-Hant-TW","中文 (台灣)"],["yue-Hant-HK","粵語 (香港)"]],["日本語",["ja-JP"]],["Lingua latīna",["la"]]];for(var e=0;e<this.langs.length;e++)this.select_language.options[e]=new Option(this.langs[e][0],e);this.select_language.selectedIndex=this.model.get("language"),this.updateCountry(),this.select_dialect.value=this.model.get("dialect")},updateCountry:function(){for(var e=this.select_dialect.options.length-1;e>=0;e--)this.select_dialect.remove(e);for(var t=this.langs[this.select_language.selectedIndex],e=1;e<t.length;e++)this.select_dialect.options.add(new Option(t[e][1],t[e][0]));this.select_dialect.style.visibility=1==t[1].length?"hidden":"visible"},updateLang:function(){this.model.set("lang",this.voiceDialects[this.model.get("voice")])}})});